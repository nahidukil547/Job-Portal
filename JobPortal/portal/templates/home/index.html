{% extends "index.html" %}

{% load static %}
{% block linkcss %}

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
{% endblock linkcss %}
{% block content %}
<section class="featured-jobs" id="jobs">
    <div class="container">
        <form method="get" id="jobFilterForm">
            <!-- Search Bar -->
            <div class="jobs-header">
                <h2>Find Your Perfect Job</h2>
                <div class="jobs-search">
                    <div class="search-input-group">
                        <i class="fas fa-search"></i>
                        <input type="text" name="query" id="jobsSearch"
                               placeholder="Search jobs, companies, or keywords..."
                               value="{{ query }}">
                    </div>
                </div>
            </div>

            <div class="jobs-layout">
                <!-- Sidebar Filters -->
                <aside class="filters-sidebar">

                    <button type="submit" class="clear-filters">
                        <i class="fas fa-filter"></i>
                        Apply Filters
                    </button>

                    
                    <!-- Job Type -->
                    <div class="filter-section">
                        <h3>Job Type</h3>
                        <div class="filter-group">
                            {% for val, label in job_type_choices %}
                                <label class="filter-checkbox">
                                    <input type="checkbox" name="job_type" value="{{ val }}"
                                        {% if val in selected_job_type %}checked{% endif %}>
                                    <span class="checkmark"></span>
                                    {{ label }}
                                </label>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Experience Level -->
                    <div class="filter-section">
                        <h3>Experience Level</h3>
                        <div class="filter-group">
                            {% for val, label in exp_level_choices %}
                                <label class="filter-checkbox">
                                    <input type="checkbox" name="exp_level" value="{{ val }}"
                                        {% if val in selected_exp_level %}checked{% endif %}>
                                    <span class="checkmark"></span>
                                    {{ label }}
                                </label>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Buttons -->
                    <a href="{% url 'home' %}" class="clear-filters" style="margin-top: 10px;">
                        <i class="fas fa-times"></i>
                        Clear All Filters
                    </a>
                    
                </aside>

                <!-- Jobs Content -->
                <div class="jobs-content">
                    <div class="jobs-results-header">
                        <div class="results-count">
                            Showing {{ page_obj.start_index }} to {{ page_obj.end_index }}
                            of {{ page_obj.paginator.count }} jobs
                        </div>
                    </div>

                    <!-- Job Listings -->
                    <div class="jobs-grid">
                        {% if jobs %}
                            {% for job in jobs %}
                                <div class="job-card">
                                    <div class="job-header">
                                        <div class="job-info">
                                            <h3>{{ job.title }}</h3>
                                            <div class="company-name">{{ job.company_name }}</div>
                                            <div class="job-location">
                                                <i class="fas fa-map-marker-alt"></i>
                                                <strong>Location:</strong> {{ job.location }}
                                            </div>
                                        </div>
                                        <div class="company-logo">
                                            {{ job.company_name|slice:":1" }}
                                        </div>
                                    </div>

                                    <div class="job-details">
                                        <div class="job-description">{{ job.about_job|striptags|truncatechars:100 }}</div>
                                    </div>

                                    <div class="job-footer">
                                        <div>
                                            {% if job.salary_range == 'Negotiable' %}
                                                <div class="job-description">Negotiable</div>
                                            {% else %}
                                                <div class="job-salary">${{ job.salary_range }}</div>
                                            {% endif %}
                                            <div class="job-posted">
                                                Posted: {{ job.created_at|timesince }} ago
                                            </div>
                                        </div>
                                        <a href="{% url 'job_details' slug=job.slug %}">
                                            <span class="apply-btn">Apply Now</span>
                                        </a>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="no-results">No jobs found based on your criteria.</div>
                        {% endif %}
                    </div>

                    <!-- Pagination -->
                    {% if page_obj.has_other_pages %}
                        <div class="pagination-section">
                            <div class="pagination">
                                {% if page_obj.has_previous %}
                                    <a href="?page={{ page_obj.previous_page_number }}{% if query %}&query={{ query }}{% endif %}{% for jt in selected_job_type %}&job_type={{ jt }}{% endfor %}{% for exp in selected_exp_level %}&exp_level={{ exp }}{% endfor %}">
                                        <button class="pagination-btn"><i class="fas fa-chevron-left"></i></button>
                                    </a>
                                {% else %}
                                    <button class="pagination-btn" disabled><i class="fas fa-chevron-left"></i></button>
                                {% endif %}

                                {% for num in page_obj.paginator.page_range %}
                                    {% if num == page_obj.number %}
                                        <button class="pagination-btn active">{{ num }}</button>
                                    {% else %}
                                        <a href="?page={{ num }}{% if query %}&query={{ query }}{% endif %}{% for jt in selected_job_type %}&job_type={{ jt }}{% endfor %}{% for exp in selected_exp_level %}&exp_level={{ exp }}{% endfor %}">
                                            <button class="pagination-btn">{{ num }}</button>
                                        </a>
                                    {% endif %}
                                {% endfor %}

                                {% if page_obj.has_next %}
                                    <a href="?page={{ page_obj.next_page_number }}{% if query %}&query={{ query }}{% endif %}{% for jt in selected_job_type %}&job_type={{ jt }}{% endfor %}{% for exp in selected_exp_level %}&exp_level={{ exp }}{% endfor %}">
                                        <button class="pagination-btn"><i class="fas fa-chevron-right"></i></button>
                                    </a>
                                {% else %}
                                    <button class="pagination-btn" disabled><i class="fas fa-chevron-right"></i></button>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </form>
    </div>
</section>

{% endblock content %}